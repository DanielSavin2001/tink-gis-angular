'use strict';
class LayerRAW {
    constructor(layerJSON) {
        Object.assign(this, layerJSON);
    }
}
class Layer extends LayerRAW {
    constructor(info, parenttheme) {
        super(info);
        this.UpdateDisplayed = (currentScale) => {
            if (this.maxScale > 0 || this.minScale > 0) {
                console.log('MinMaxandCurrentScale', this.maxScale, this.minScale, currentScale);
                if (currentScale > this.maxScale && currentScale < this.minScale) {
                    this.displayed = true;
                }
                else {
                    this.displayed = false;
                }
            }
        };
        this.visible = info.defaultVisibility;
        this.enabled = true;
        this.parent = null;
        this.title = info.name;
        this.theme = parenttheme;
        this.displayed = true;
        if (this.parentLayerId === -1 && this.subLayerIds !== null) {
            this.type = LayerType.GROUP;
        }
        else {
            this.type = LayerType.LAYER;
        }
    }
}
class Theme {
    constructor() {
        this.UpdateDisplayed = (currentScale) => {
            this.AllLayers.forEach(layer => {
                layer.UpdateDisplayed(currentScale);
            });
        };
        this.UpdateMap = () => {
            this.RecalculateVisibleLayerIds();
            this.MapData.setLayers(this.VisibleLayerIds);
        };
        this.RecalculateVisibleLayerIds = () => {
            this.VisibleLayerIds.length = 0;
            this.VisibleLayers.forEach(visLayer => {
                this.VisibleLayerIds.push(visLayer.id);
            });
            if (this.VisibleLayerIds.length === 0) {
                this.VisibleLayerIds.push(-1);
            }
        };
    }
}
class ArcGIStheme extends Theme {
    constructor(rawdata, themeData) {
        super();
        let rawlayers = rawdata.layers;
        this.Naam = rawdata.documentInfo.Title;
        this.name = rawdata.documentInfo.Title;
        this.Description = rawdata.documentInfo.Subject;
        this.Layers = [];
        this.AllLayers = [];
        this.Groups = [];
        this.CleanUrl = themeData.cleanUrl;
        this.Url = themeData.url;
        this.VisibleLayers = [];
        this.VisibleLayerIds = [];
        this.Visible = true;
        this.Added = false;
        this.enabled = true;
        this.Type = ThemeType.ESRI;
        this.status = ThemeStatus.NEW;
        this.MapData = {};
        rawlayers.forEach((layerInfo) => {
            let layer = new Layer(layerInfo, this);
            this.AllLayers.push(layer);
            if (layer.parentLayerId === -1) {
                if (layer.subLayerIds === null) {
                    this.Layers.push(layer);
                }
                else {
                    this.Groups.push(layer);
                }
            }
        });
        this.Groups.forEach((layerGroup) => {
            if (layerGroup.subLayerIds !== null) {
                layerGroup.Layers = [];
                this.AllLayers.forEach((layer) => {
                    if (layerGroup.id === layer.parentLayerId) {
                        layer.parent = layerGroup;
                        layerGroup.Layers.push(layer);
                    }
                });
            }
        });
        this.RecalculateVisibleLayerIds();
    }
}
(function () {
    var module = angular.module('tink.gis');
    var service = function () {
        var themeHelper = {};
        themeHelper.createThemeFromJson = function (rawdata, themeData) {
            let theme = new ArcGIStheme(rawdata, themeData);
            return theme;
        };
        return themeHelper;
    };
    module.factory('ThemeHelper', service);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXJjR0lTdGhlbWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBcmNHSVN0aGVtZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUFHYjtJQVFJLFlBQVksU0FBYztRQUN0QixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNuQyxDQUFDO0FBQ0wsQ0FBQztBQUNELG9CQUFvQixRQUFRO0lBVXhCLFlBQVksSUFBYyxFQUFFLFdBQWtCO1FBQzFDLE1BQU0sSUFBSSxDQUFDLENBQUM7UUFlaEIsb0JBQWUsR0FBRyxDQUFDLFlBQVk7WUFDM0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6QyxPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQztnQkFDakYsRUFBRSxDQUFDLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO29CQUMvRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDMUIsQ0FBQztnQkFDRCxJQUFJLENBQUMsQ0FBQztvQkFDRixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztnQkFDM0IsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDLENBQUM7UUF2QkUsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7UUFDdEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3ZC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QyxVQUFVLENBQUMsQ0FBQztJQUN4QyxJQUFJLE9BQU8sR0FBRztRQUNWLElBQUksV0FBVyxHQUFRLEVBQUUsQ0FBQztRQUMxQixXQUFXLENBQUMsbUJBQW1CLEdBQUcsVUFBVSxPQUFPLEVBQUUsU0FBUztZQUMxRCxJQUFJLEtBQUssR0FBRyxJQUFJLFdBQVcsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUE7WUFDL0MsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUNqQixDQUFDLENBQUM7UUFDRixNQUFNLENBQUMsV0FBVyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQztJQUNGLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQzNDLENBQUMsQ0FBQyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcbi8vIGltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcclxuLy8gaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcclxuY2xhc3MgTGF5ZXJSQVcge1xyXG4gICAgaWQ6IG51bWJlcjtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIHBhcmVudExheWVySWQ6IG51bWJlcjtcclxuICAgIGRlZmF1bHRWaXNpYmlsaXR5OiBib29sZWFuO1xyXG4gICAgc3ViTGF5ZXJJZHM6IG51bWJlcltdO1xyXG4gICAgbWluU2NhbGU6IG51bWJlcjtcclxuICAgIG1heFNjYWxlOiBudW1iZXI7XHJcbiAgICBjb25zdHJ1Y3RvcihsYXllckpTT046IGFueSkge1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgbGF5ZXJKU09OKTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBMYXllciBleHRlbmRzIExheWVyUkFXIHtcclxuICAgIHZpc2libGU6IGJvb2xlYW47XHJcbiAgICBlbmFibGVkOiBib29sZWFuO1xyXG4gICAgcGFyZW50OiBhbnk7XHJcbiAgICB0aGVtZTogVGhlbWU7XHJcbiAgICB0aXRsZTogc3RyaW5nO1xyXG4gICAgZGlzcGxheWVkOiBib29sZWFuO1xyXG4gICAgdHlwZTogbnVtYmVyO1xyXG4gICAgTGF5ZXJzOiBBcnJheTxMYXllcj47XHJcblxyXG4gICAgY29uc3RydWN0b3IoaW5mbzogTGF5ZXJSQVcsIHBhcmVudHRoZW1lOiBUaGVtZSkge1xyXG4gICAgICAgIHN1cGVyKGluZm8pO1xyXG4gICAgICAgIC8vb3NkZlxyXG4gICAgICAgIHRoaXMudmlzaWJsZSA9IGluZm8uZGVmYXVsdFZpc2liaWxpdHk7XHJcbiAgICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnBhcmVudCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50aXRsZSA9IGluZm8ubmFtZTtcclxuICAgICAgICB0aGlzLnRoZW1lID0gcGFyZW50dGhlbWU7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5ZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLnBhcmVudExheWVySWQgPT09IC0xICYmIHRoaXMuc3ViTGF5ZXJJZHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy50eXBlID0gTGF5ZXJUeXBlLkdST1VQO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50eXBlID0gTGF5ZXJUeXBlLkxBWUVSO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFVwZGF0ZURpc3BsYXllZCA9IChjdXJyZW50U2NhbGUpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5tYXhTY2FsZSA+IDAgfHwgdGhpcy5taW5TY2FsZSA+IDApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ01pbk1heGFuZEN1cnJlbnRTY2FsZScsIHRoaXMubWF4U2NhbGUsIHRoaXMubWluU2NhbGUsIGN1cnJlbnRTY2FsZSk7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50U2NhbGUgPiB0aGlzLm1heFNjYWxlICYmIGN1cnJlbnRTY2FsZSA8IHRoaXMubWluU2NhbGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheWVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XHJcbmFic3RyYWN0IGNsYXNzIFRoZW1lIHtcclxuICAgIE5hYW06IHN0cmluZztcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIERlc2NyaXB0aW9uOiBzdHJpbmc7XHJcbiAgICBDbGVhblVybDogc3RyaW5nO1xyXG4gICAgVXJsOiBzdHJpbmc7XHJcblxyXG4gICAgVmlzaWJsZTogYm9vbGVhbjtcclxuICAgIEFkZGVkOiBib29sZWFuO1xyXG4gICAgZW5hYmxlZDogYm9vbGVhbjtcclxuXHJcbiAgICBUeXBlOiBzdHJpbmc7XHJcbiAgICBzdGF0dXM6IG51bWJlcjtcclxuXHJcbiAgICBWaXNpYmxlTGF5ZXJJZHM6IEFycmF5PG51bWJlcj47XHJcbiAgICBMYXllcnM6IEFycmF5PExheWVyPjtcclxuICAgIFZpc2libGVMYXllcnM6IEFycmF5PExheWVyPjtcclxuICAgIEFsbExheWVyczogQXJyYXk8TGF5ZXI+O1xyXG4gICAgR3JvdXBzOiBBcnJheTxMYXllcj47XHJcblxyXG4gICAgTWFwRGF0YTogYW55O1xyXG5cclxuICAgIFVwZGF0ZURpc3BsYXllZCA9IChjdXJyZW50U2NhbGUpID0+IHtcclxuICAgICAgICB0aGlzLkFsbExheWVycy5mb3JFYWNoKGxheWVyID0+IHtcclxuICAgICAgICAgICAgbGF5ZXIuVXBkYXRlRGlzcGxheWVkKGN1cnJlbnRTY2FsZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBVcGRhdGVNYXAgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5SZWNhbGN1bGF0ZVZpc2libGVMYXllcklkcygpO1xyXG4gICAgICAgIHRoaXMuTWFwRGF0YS5zZXRMYXllcnModGhpcy5WaXNpYmxlTGF5ZXJJZHMpO1xyXG4gICAgfTtcclxuICAgIFJlY2FsY3VsYXRlVmlzaWJsZUxheWVySWRzID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuVmlzaWJsZUxheWVySWRzLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgdGhpcy5WaXNpYmxlTGF5ZXJzLmZvckVhY2godmlzTGF5ZXIgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLlZpc2libGVMYXllcklkcy5wdXNoKHZpc0xheWVyLmlkKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodGhpcy5WaXNpYmxlTGF5ZXJJZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuVmlzaWJsZUxheWVySWRzLnB1c2goLTEpOyAvL2FscyB3ZSBuaWV0IGRvZW4gZGFuIHpvZWt0IGhpaiBvcCBhbGxlIGxhZ2VuIVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbmNsYXNzIEFyY0dJU3RoZW1lIGV4dGVuZHMgVGhlbWUge1xyXG4gICAgY29uc3RydWN0b3IocmF3ZGF0YTogYW55LCB0aGVtZURhdGE6IGFueSkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgbGV0IHJhd2xheWVycyA9IHJhd2RhdGEubGF5ZXJzO1xyXG4gICAgICAgIHRoaXMuTmFhbSA9IHJhd2RhdGEuZG9jdW1lbnRJbmZvLlRpdGxlO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IHJhd2RhdGEuZG9jdW1lbnRJbmZvLlRpdGxlO1xyXG4gICAgICAgIHRoaXMuRGVzY3JpcHRpb24gPSByYXdkYXRhLmRvY3VtZW50SW5mby5TdWJqZWN0O1xyXG4gICAgICAgIHRoaXMuTGF5ZXJzID0gW107IC8vIGRlIGxheWVycyBkaXJlY3Qgb25kZXIgaGV0IHRoZW1lIHpvbmRlciBzdWJsYXllcnNcclxuICAgICAgICB0aGlzLkFsbExheWVycyA9IFtdOyAvLyBhbGxlIExheWVycyBkaWUgaGlqIGhlZWZ0IGluY2x1ZGluZyBzdWJncm91cGxheWVyc1xyXG4gICAgICAgIHRoaXMuR3JvdXBzID0gW107IC8vIGxheWVyZ3JvdXBzIGRpZSBub2cgZWVucyBsYXllcnMgemVsZiBoZWJiZW5cclxuICAgICAgICB0aGlzLkNsZWFuVXJsID0gdGhlbWVEYXRhLmNsZWFuVXJsO1xyXG4gICAgICAgIHRoaXMuVXJsID0gdGhlbWVEYXRhLnVybDtcclxuICAgICAgICB0aGlzLlZpc2libGVMYXllcnMgPSBbXTtcclxuICAgICAgICB0aGlzLlZpc2libGVMYXllcklkcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5BZGRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5UeXBlID0gVGhlbWVUeXBlLkVTUkk7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBUaGVtZVN0YXR1cy5ORVc7XHJcbiAgICAgICAgdGhpcy5NYXBEYXRhID0ge307XHJcbiAgICAgICAgcmF3bGF5ZXJzLmZvckVhY2goKGxheWVySW5mbykgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbGF5ZXIgPSBuZXcgTGF5ZXIobGF5ZXJJbmZvLCB0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5BbGxMYXllcnMucHVzaChsYXllcik7XHJcbiAgICAgICAgICAgIGlmIChsYXllci5wYXJlbnRMYXllcklkID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxheWVyLnN1YkxheWVySWRzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5MYXllcnMucHVzaChsYXllcik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuR3JvdXBzLnB1c2gobGF5ZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5Hcm91cHMuZm9yRWFjaCgobGF5ZXJHcm91cCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAobGF5ZXJHcm91cC5zdWJMYXllcklkcyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgbGF5ZXJHcm91cC5MYXllcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuQWxsTGF5ZXJzLmZvckVhY2goKGxheWVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyR3JvdXAuaWQgPT09IGxheWVyLnBhcmVudExheWVySWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXIucGFyZW50ID0gbGF5ZXJHcm91cDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXJHcm91cC5MYXllcnMucHVzaChsYXllcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLlJlY2FsY3VsYXRlVmlzaWJsZUxheWVySWRzKCk7XHJcbiAgICB9XHJcbn1cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgndGluay5naXMnKTtcclxuICAgIHZhciBzZXJ2aWNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0aGVtZUhlbHBlcjogYW55ID0ge307XHJcbiAgICAgICAgdGhlbWVIZWxwZXIuY3JlYXRlVGhlbWVGcm9tSnNvbiA9IGZ1bmN0aW9uIChyYXdkYXRhLCB0aGVtZURhdGEpIHtcclxuICAgICAgICAgICAgbGV0IHRoZW1lID0gbmV3IEFyY0dJU3RoZW1lKHJhd2RhdGEsIHRoZW1lRGF0YSlcclxuICAgICAgICAgICAgcmV0dXJuIHRoZW1lO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoZW1lSGVscGVyO1xyXG4gICAgfTtcclxuICAgIG1vZHVsZS5mYWN0b3J5KCdUaGVtZUhlbHBlcicsIHNlcnZpY2UpO1xyXG59KSgpO1xyXG4iXX0=