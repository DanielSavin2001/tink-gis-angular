{"version":3,"sources":["../../../src/scripts/shared/L.TileLayer.BetterWMS.js"],"names":[],"mappings":"AAAA;;AACA,EAAE,SAAF,CAAY,SAAZ,GAAwB,EAAE,SAAF,CAAY,GAAZ,CAAgB,MAAhB,CAAuB;;;;;;;;;;;;;;;;AAgB3C,oBAAgB,wBAAS,MAAT,EAAiB,MAAjB,EAAyB;;AAErC,YAAI,MAAM,KAAK,iBAAL,CAAuB,MAAvB,EAA+B,MAA/B,CAAN;;AAFiC,YAIjC,OAAO,EAAE,IAAF,CAAO;AACd,iBAAK,GAAL;AACA,qBAAS,iBAAS,IAAT,EAAe,MAAf,EAAuB,GAAvB,EAA4B;;;;;;;;aAA5B;AAUT,mBAAO,eAAS,GAAT,EAAc,MAAd,EAAsB,MAAtB,EAA6B;;aAA7B;SAZA,CAAP,CAJiC;AAoBrC,eAAO,IAAP,CApBqC;KAAzB;;AAuBhB,uBAAmB,2BAAS,MAAT,EAAiB,MAAjB,EAAyB;;AAExC,YAAI,QAAQ,KAAK,IAAL,CAAU,sBAAV,CAAiC,MAAjC,EAAyC,KAAK,IAAL,CAAU,OAAV,EAAzC,CAAR;YACA,OAAO,KAAK,IAAL,CAAU,OAAV,EAAP;YAEA,SAAS;AACL,qBAAS,gBAAT;AACA,qBAAS,KAAT;AACA,iBAAK,WAAL;AACA,oBAAQ,KAAK,SAAL,CAAe,MAAf;AACR,yBAAa,KAAK,SAAL,CAAe,WAAf;AACb,qBAAS,KAAK,SAAL,CAAe,OAAf;AACT,oBAAQ,KAAK,SAAL,CAAe,MAAf;AACR,kBAAM,KAAK,IAAL,CAAU,SAAV,GAAsB,YAAtB,EAAN;AACA,oBAAQ,KAAK,CAAL;AACR,mBAAO,KAAK,CAAL;AACP,oBAAQ,MAAR;AACA,0BAAc,MAAd;AACA,oBAAQ,GAAR;AACA,yBAAa,UAAb;SAdJ,CALoC;;AAsBxC,eAAO,OAAO,OAAP,KAAmB,OAAnB,GAA6B,GAA7B,GAAmC,GAAnC,CAAP,GAAiD,MAAM,CAAN,CAtBT;AAuBxC,eAAO,OAAO,OAAP,KAAmB,OAAnB,GAA6B,GAA7B,GAAmC,GAAnC,CAAP,GAAiD,MAAM,CAAN,CAvBT;;AAyBxC,eAAO,KAAK,IAAL,GAAY,EAAE,IAAF,CAAO,cAAP,CAAsB,MAAtB,EAA8B,KAAK,IAAL,EAAW,IAAzC,CAAZ,CAzBiC;KAAzB;;CAvCC,CAAxB;;;;;;;;;;;AA8EA,EAAE,SAAF,CAAY,SAAZ,GAAwB,UAAS,GAAT,EAAc,OAAd,EAAuB;AAC3C,WAAO,IAAI,EAAE,SAAF,CAAY,SAAZ,CAAsB,GAA1B,EAA+B,OAA/B,CAAP,CAD2C;CAAvB","file":"L.js","sourcesContent":["'use strict'\r\nL.TileLayer.BetterWMS = L.TileLayer.WMS.extend({\r\n\r\n    // onAdd: function(map) {\r\n    //     // Triggered when the layer is added to a map.\r\n    //     //   Register a click listener, then do all the upstream WMS things\r\n    //     L.TileLayer.WMS.prototype.onAdd.call(this, map);\r\n    //     map.on('click', this.getFeatureInfo, this);\r\n    // },\r\n\r\n    // onRemove: function(map) {\r\n    //     // Triggered when the layer is removed from a map.\r\n    //     //   Unregister a click listener, then do all the upstream WMS things\r\n    //     L.TileLayer.WMS.prototype.onRemove.call(this, map);\r\n    //     map.off('click', this.getFeatureInfo, this);\r\n    // },\r\n\r\n    getFeatureInfo: function(latlng, layers) {\r\n        // Make an AJAX request to the server and hope for the best\r\n        var url = this.getFeatureInfoUrl(latlng, layers);\r\n            // showResults = L.Util.bind(this.showGetFeatureInfo, this);\r\n        var prom = $.ajax({\r\n            url: url,\r\n            success: function(data, status, xhr) {\r\n                // var err = typeof data === 'string' ? null : data;\r\n                // showResults(err, latlng, data);\r\n                // console.log(data);\r\n                // var xmlstring = JXON.xmlToString(data);\r\n                // var returnjson = JXON.stringToJs(xmlstring);\r\n\r\n\r\n                // console.log(returnjson);\r\n            },\r\n            error: function(xhr, status, error) {\r\n                // showResults(error);\r\n            }\r\n        });\r\n        return prom;\r\n    },\r\n\r\n    getFeatureInfoUrl: function(latlng, layers) {\r\n        // Construct a GetFeatureInfo request URL given a point\r\n        var point = this._map.latLngToContainerPoint(latlng, this._map.getZoom()),\r\n            size = this._map.getSize(),\r\n\r\n            params = {\r\n                request: 'GetFeatureInfo',\r\n                service: 'WMS',\r\n                srs: 'EPSG:4326',\r\n                styles: this.wmsParams.styles,\r\n                transparent: this.wmsParams.transparent,\r\n                version: this.wmsParams.version,\r\n                format: this.wmsParams.format,\r\n                bbox: this._map.getBounds().toBBoxString(),\r\n                height: size.y,\r\n                width: size.x,\r\n                layers: layers,\r\n                query_layers: layers,\r\n                buffer: 100,\r\n                info_format: 'text/xml'\r\n            };\r\n\r\n        params[params.version === '1.3.0' ? 'i' : 'x'] = point.x;\r\n        params[params.version === '1.3.0' ? 'j' : 'y'] = point.y;\r\n\r\n        return this._url + L.Util.getParamString(params, this._url, true);\r\n    },\r\n\r\n    // showGetFeatureInfo: function(err, latlng, content) {\r\n    //     if (err) { console.log(err); return; } // do nothing if there's an error\r\n\r\n    //     // Otherwise show the content in a popup, or something.\r\n    //     L.popup({ maxWidth: 800 })\r\n    //         .setLatLng(latlng)\r\n    //         .setContent(content)\r\n    //         .openOn(this._map);\r\n    // }\r\n});\r\n\r\nL.tileLayer.betterWms = function(url, options) {\r\n    return new L.TileLayer.BetterWMS(url, options);\r\n};"]}