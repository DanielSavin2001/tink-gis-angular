{"version":3,"sources":["../../../src/scripts/services/mapData.js"],"names":[],"mappings":"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","file":"mapData.js","sourcesContent":["'use strict';\r\n(function () {\r\n    var module = angular.module('tink.gis');\r\n    var mapData = function (map, $rootScope, HelperService, ResultsData) {\r\n        var _data = {};\r\n\r\n        _data.VisibleLayers = [];\r\n        _data.SelectableLayers = [];\r\n        _data.VisibleFeatures = [];\r\n        _data.Loading = 0;\r\n        _data.IsDrawing = false;\r\n        _data.ThemeUrls = ['http://app11.p.gis.local/arcgissql/rest/services/P_Stad/Afval/MapServer/',\r\n            'http://app11.p.gis.local/arcgissql/rest/services/P_Stad/Cultuur/MapServer/',\r\n            'http://app11.p.gis.local/arcgissql/rest/services/P_Stad/Jeugd/MapServer/',\r\n            'http://app11.p.gis.local/arcgissql/rest/services/P_Stad/Onderwijs/MapServer/',\r\n            'http://app11.p.gis.local/arcgissql/rest/services/P_Stad/stad/MapServer/'\r\n        ];\r\n        _data.Themes = [];\r\n        var defaultlayer = { id: '', name: 'Alle Layers' };\r\n        _data.SelectedLayer = defaultlayer;\r\n        _data.VisibleLayers.unshift(defaultlayer);\r\n        _data.ActiveInteractieKnop = ActiveInteractieButton.IDENTIFY;\r\n        _data.DrawingType = DrawingOption.NIETS;\r\n        _data.DrawingObject = null;\r\n        _data.LastIdentifyBounds = null;\r\n        _data.CleanDrawings = function () {\r\n            if (_data.DrawingObject) {\r\n                if (_data.DrawingObject.layer) { // if the layer (drawing) is created\r\n                    _data.DrawingObject.layer._popup = null; // remove popup first because else it will fire close event which will do an other clean of the drawings which is not needed\r\n                }\r\n                _data.DrawingObject.disable();\r\n                _data.DrawingObject = null;\r\n                map.clearDrawings();\r\n            }\r\n        };\r\n        var WatIsHierMarker = null;\r\n        var WatIsHierOriginalMarker = null;\r\n        _data.CleanAll = function () {\r\n            _data.CleanDrawings();\r\n            _data.CleanWatIsHier();\r\n            _data.CleanSearch();\r\n        };\r\n        _data.CleanWatIsHier = function () {\r\n            if (WatIsHierOriginalMarker) {\r\n                WatIsHierOriginalMarker.clearAllEventListeners();\r\n                WatIsHierOriginalMarker.closePopup();\r\n                map.removeLayer(WatIsHierOriginalMarker);\r\n                WatIsHierOriginalMarker = null;\r\n            }\r\n            if (WatIsHierMarker) {\r\n                map.removeLayer(WatIsHierMarker);\r\n                WatIsHierMarker = null;\r\n            }\r\n            straatNaam = null;\r\n        };\r\n        _data.CreateOrigineleMarker = function (latlng, addressFound) {\r\n            if (addressFound) {\r\n                var foundMarker = L.AwesomeMarkers.icon({\r\n                    icon: 'fa-map-marker',\r\n                    markerColor: 'orange'\r\n\r\n                });\r\n                WatIsHierOriginalMarker = L.marker([latlng.lat, latlng.lng], { icon: foundMarker, opacity: 0.5 }).addTo(map);\r\n            }\r\n            else {\r\n                var notFoundMarker = L.AwesomeMarkers.icon({\r\n                    // icon: 'fa-frown-o',\r\n                    icon: 'fa-question',\r\n                    markerColor: 'red',\r\n                    spin: true\r\n                });\r\n                WatIsHierOriginalMarker = L.marker([latlng.lat, latlng.lng], { icon: notFoundMarker }).addTo(map);\r\n            }\r\n            var convertedxy = HelperService.ConvertWSG84ToLambert72(latlng);\r\n            if (straatNaam) {\r\n                var html =\r\n                    '<div class=\"container container-low-padding\">' +\r\n                    '<div class=\"row row-no-padding\">' +\r\n                    '<div class=\"col-sm-4\">' +\r\n                    '<a href=\"templates/external/streetView.html?lat=' + latlng.lat + '&lng=' + latlng.lng + '\" + target=\"_blank\" >' +\r\n                    '<img src=\"https://maps.googleapis.com/maps/api/streetview?size=100x50&location=' + latlng.lat + ',' + latlng.lng + '&pitch=-0.76\" />' +\r\n                    '</a>' +\r\n                    '</div>' +\r\n                    '<div class=\"col-sm-8\">' +\r\n                    '<div class=\"col-sm-12\"><b>' + straatNaam + '</b></div>' +\r\n                    // '<div class=\"row\">' +\r\n                    '<div class=\"col-sm-3\">WGS84:</div><div class=\"col-sm-8\" style=\"text-align: left;\">' + latlng.lat.toFixed(6) + ', ' + latlng.lng.toFixed(6) + '</div><div class=\"col-sm-1\"><i class=\"fa fa-files-o\"></i></div>' +\r\n                    '<div class=\"col-sm-3\">Lambert:</div><div class=\"col-sm-8\" style=\"text-align: left;\">' + convertedxy.x.toFixed(1) + ', ' + convertedxy.y.toFixed(1) + '</div><div class=\"col-sm-1\"><i class=\"fa fa-files-o\"></i></div>' +\r\n                    // '<div class=\"row\">Lambert (x,y):' + convertedxy.x.toFixed(1) + ',' + convertedxy.y.toFixed(1) + '</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n\r\n                    '</div>';\r\n                // var html = '<tink-Theme></tink-Theme>'\r\n                WatIsHierOriginalMarker.bindPopup(html, { minWidth: 300 }).openPopup();\r\n            }\r\n            else {\r\n                WatIsHierOriginalMarker.bindPopup(\r\n                    'WGS84 (x,y):' + latlng.lat.toFixed(6) + ',' + latlng.lng.toFixed(6) +\r\n                    '<br>Lambert (x,y):' + convertedxy.x.toFixed(1) + ',' + convertedxy.y.toFixed(1)).openPopup();\r\n            }\r\n\r\n\r\n            WatIsHierOriginalMarker.on('popupclose', function (event) {\r\n                _data.CleanWatIsHier();\r\n            });\r\n        };\r\n        var straatNaam = null;\r\n        _data.CreateWatIsHierMarker = function (data) {\r\n            var convertedBackToWSG84 = HelperService.ConvertLambert72ToWSG84(data.location)\r\n            straatNaam = data.address.Street + ' (' + data.address.Postal + ')';\r\n            var greenIcon = L.icon({\r\n                iconUrl: 'styles/fa-dot-circle-o_24_0_000000_none.png',\r\n                iconSize: [24, 24]\r\n            });\r\n\r\n\r\n            WatIsHierMarker = L.marker([convertedBackToWSG84.x, convertedBackToWSG84.y], { icon: greenIcon }).addTo(map);\r\n\r\n        };\r\n        _data.CleanSearch = function () {\r\n            ResultsData.CleanSearch();\r\n            for (var x = 0; x < _data.VisibleFeatures.length; x++) {\r\n                map.removeLayer(_data.VisibleFeatures[x]); //eerst de\r\n            }\r\n            _data.VisibleFeatures.length = 0;\r\n        };\r\n        _data.PanToFeature = function (feature) {\r\n            console.log(\"FEATUREPANTO\");\r\n            var tmplayer = feature.mapItem._layers[Object.keys(feature.mapItem._layers)[0]]\r\n            if (tmplayer._latlngs) { // with s so it has bounds etc\r\n                map.fitBounds(tmplayer.getBounds(), { paddingTopLeft: L.point(25, 25), paddingBottomRight: L.point(25, 25) });\r\n            }\r\n            else {\r\n                // map.panTo(tmplayer.getLatLng());\r\n            }\r\n        };\r\n        _data.GoToLastClickBounds = function () {\r\n            map.fitBounds(_data.LastIdentifyBounds, { paddingTopLeft: L.point(0, 0), paddingBottomRight: L.point(0, 0) });\r\n        };\r\n        _data.SetZIndexes = function () {\r\n            var counter = _data.Themes.length + 3;\r\n            _data.Themes.forEach(theme => {\r\n                theme.MapData.ZIndex = counter;\r\n                if (theme.Type == ThemeType.ESRI) {\r\n                    if (theme.MapData._currentImage) {\r\n                        theme.MapData._currentImage._image.style.zIndex = counter;\r\n                    }\r\n                } else { // WMS\r\n                    theme.MapData.bringToFront();\r\n                    theme.MapData.setZIndex(counter);\r\n                }\r\n                counter--;\r\n\r\n            });\r\n        };\r\n        _data.AddFeatures = function (features, theme, layerId) {\r\n            if (features.length == 0) {\r\n                ResultsData.EmptyResult = true;\r\n            }\r\n            else {\r\n                ResultsData.EmptyResult = false;\r\n                for (var x = 0; x < features.features.length; x++) {\r\n                    var featureItem = features.features[x];\r\n\r\n                    var layer = {};\r\n                    if (featureItem.layerId != undefined && featureItem.layerId != null) {\r\n                        layer = theme.AllLayers.find(x => x.id === featureItem.layerId);\r\n                    }\r\n                    else if (layerId != undefined && layerId != null) {\r\n                        layer = theme.AllLayers.find(x => x.id === layerId);\r\n                    } else {\r\n                        console.log('NO LAYER ID WAS GIVEN EITHER FROM FEATURE ITEM OR FROM PARAMETER');\r\n                    }\r\n                    // featureItem.layer = layer;\r\n                    featureItem.theme = theme;\r\n                    featureItem.layerName = layer.name;\r\n                    if (theme.Type === ThemeType.ESRI) {\r\n                        layer.fields.forEach(field => {\r\n                            if (field.type == 'esriFieldTypeDate') {\r\n                                var date = new Date(featureItem.properties[field.name]);\r\n                                var date_string = (date.getDate() + 1) + '/' + (date.getMonth() + 1) + '/' + date.getFullYear(); // \"2013-9-23\"\r\n                                featureItem.properties[field.name] = date_string;\r\n                            }\r\n                        });\r\n                        featureItem.displayValue = featureItem.properties[layer.displayField];\r\n                        var mapItem = L.geoJson(featureItem, { style: Style.DEFAULT }).addTo(map);\r\n                        _data.VisibleFeatures.push(mapItem);\r\n                        featureItem.mapItem = mapItem;\r\n                    }\r\n                    else {\r\n                        featureItem.displayValue = featureItem.properties[Object.keys(featureItem.properties)[0]];\r\n                    }\r\n                    ResultsData.JsonFeatures.push(featureItem);\r\n                }\r\n                $rootScope.$apply();\r\n            }\r\n        };\r\n        return _data;\r\n    };\r\n    module.$inject = ['ResultsData'];\r\n    module.factory('MapData', mapData);\r\n})();\r\n\r\n\r\n"]}