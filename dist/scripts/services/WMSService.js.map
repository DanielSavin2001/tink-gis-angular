{"version":3,"sources":["../../../src/scripts/services/WMSService.js"],"names":[],"mappings":"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","file":"WMSService.js","sourcesContent":["'use strict';\r\n(function() {\r\n    var module;\r\n    try {\r\n        module = angular.module('tink.gis');\r\n    } catch (e) {\r\n        module = angular.module('tink.gis', ['tink.accordion', 'tink.tinkApi', 'ui.sortable', 'tink.modal', 'angular.filter']); //'leaflet-directive'\r\n    }\r\n    var service = function($http, $window, map) {\r\n        var _service = {};\r\n\r\n        _service.GetCapabilities = function(url) {\r\n            var posturl = '?request=GetCapabilities&service=WMS&callback=foo';\r\n            var prom = $http({\r\n                method: 'GET',\r\n                url: url + posturl,\r\n                timeout: 10000,\r\n                // params: {},  // Query Parameters (GET)\r\n                transformResponse: function(data) {\r\n                    var wmstheme = {};\r\n                    if (data) {\r\n                        var returnjson = JXON.stringToJs(data).wms_capabilities;\r\n                        console.log(returnjson);\r\n                        wmstheme.Version = returnjson['version'];\r\n                        wmstheme.name = returnjson.service.title;\r\n                        wmstheme.Naam = returnjson.service.title;\r\n                        // wmstheme.Title = returnjson.service.title;\r\n                        wmstheme.enabled = true;\r\n                        wmstheme.Visible = true;\r\n                        wmstheme.Layers = [];\r\n                        wmstheme.AllLayers = [];\r\n                        wmstheme.Groups = []; // layergroups die nog eens layers zelf hebben\r\n                        wmstheme.CleanUrl = url;\r\n                        wmstheme.Added = false;\r\n                        wmstheme.status = ThemeStatus.NEW;\r\n                        wmstheme.Description = returnjson.service.abstract;\r\n                        wmstheme.Type = ThemeType.WMS;\r\n                        wmstheme.VisibleLayerIds = [];\r\n                        wmstheme.VisibleLayers = [];\r\n                        var createLayer = function(layer) {\r\n                            var tmplayer = {};\r\n                            tmplayer.visible = true;\r\n                            tmplayer.enabled = true;\r\n                            tmplayer.parent = null;\r\n                            tmplayer.theme = wmstheme;\r\n                            tmplayer.name = layer.name;\r\n                            tmplayer.title = layer.title;\r\n                            tmplayer.queryable = layer.queryable;\r\n                            tmplayer.type = LayerType.LAYER;\r\n                            tmplayer.id = layer.name; //names are the ids of the layer in wms\r\n                            wmstheme.Layers.push(tmplayer);\r\n                            wmstheme.AllLayers.push(tmplayer);\r\n                        };\r\n                        var layers = returnjson.capability.layer.layer;\r\n                        if (layers) {\r\n                            layers.forEach(layer => {\r\n                                createLayer(layer);\r\n                            });\r\n                        } else {\r\n                            createLayer(returnjson.capability.layer);\r\n                        }\r\n\r\n\r\n                        wmstheme.UpdateMap = function() {\r\n                            wmstheme.RecalculateVisibleLayerIds();\r\n                            map.removeLayer(wmstheme.MapData);\r\n                            map.addLayer(wmstheme.MapData);\r\n                        };\r\n\r\n                        wmstheme.RecalculateVisibleLayerIds = function() {\r\n                            wmstheme.VisibleLayerIds.length = 0;\r\n                            _.forEach(wmstheme.VisibleLayers, function(visLayer) {\r\n                                wmstheme.VisibleLayerIds.push(visLayer.id);\r\n                            });\r\n                            if (wmstheme.VisibleLayerIds.length === 0) {\r\n                                wmstheme.VisibleLayerIds.push(-1); //als we niet doen dan zoekt hij op alle lagen!\r\n                            }\r\n                        };\r\n                        wmstheme.RecalculateVisibleLayerIds();\r\n\r\n                    }\r\n\r\n                    return wmstheme;\r\n                }\r\n            }).success(function(data, status, headers, config) {\r\n                console.dir(data);  // XML document object\r\n            }).error(function(data, status, headers, config) {\r\n                console.log('error: data, status, headers, config:');\r\n                console.log(data);\r\n                console.log(status);\r\n                console.log(headers);\r\n                console.log(config);\r\n                $window.alert('error');\r\n            });\r\n            return prom;\r\n        };\r\n\r\n        return _service;\r\n    };\r\n    module.factory('WMSService', service);\r\n})();\r\n"]}