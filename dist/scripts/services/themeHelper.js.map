{"version":3,"sources":["../../../src/scripts/services/themeHelper.js"],"names":[],"mappings":"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","file":"themeHelper.js","sourcesContent":["'use strict';\r\n(function () {\r\n    var module;\r\n    try {\r\n        module = angular.module('tink.gis');\r\n    } catch (e) {\r\n        module = angular.module('tink.gis', ['tink.accordion', 'tink.tinkApi']); //'leaflet-directive'\r\n    }\r\n    var service = function () {\r\n        var themeHelper = {};\r\n        themeHelper.createThemeFromJson = function (rawdata, getData) {\r\n            var thema = {};\r\n            try {\r\n                var rawlayers = rawdata.layers;\r\n                var cleanUrl = getData.url.substring(0, getData.url.indexOf('?'));\r\n                thema.Naam = rawdata.documentInfo.Title;\r\n                thema.name = rawdata.documentInfo.Title;\r\n                thema.Description = rawdata.documentInfo.Subject;\r\n                thema.Layers = []; // de layers direct onder het theme zonder sublayers\r\n                thema.AllLayers = []; // alle Layers die hij heeft including subgrouplayers\r\n                thema.Groups = []; // layergroups die nog eens layers zelf hebben\r\n                thema.CleanUrl = cleanUrl;\r\n                thema.Url = getData.url;\r\n                thema.VisibleLayers = [];\r\n                thema.VisibleLayerIds = [];\r\n                thema.Visible = true;\r\n                thema.Added = false;\r\n                thema.enabled = true;\r\n                thema.Type = ThemeType.ESRI;\r\n                thema.status = ThemeStatus.NEW;\r\n                thema.MapData = {};\r\n                _.each(rawlayers, function (x) {\r\n                    x.visible = true;\r\n                    x.enabled = true;\r\n                    x.parent = null;\r\n                    x.title = x.name;\r\n                    x.theme = thema;\r\n                    x.type = LayerType.LAYER;\r\n                    thema.AllLayers.push(x);\r\n                    if (x.parentLayerId === -1) {\r\n                        if (x.subLayerIds === null) {\r\n                            thema.Layers.push(x);\r\n                        } else {\r\n                            thema.Groups.push(x);\r\n                            x.type = LayerType.GROUP;\r\n                        }\r\n                    }\r\n                });\r\n                _.each(thema.Groups, function (layerGroup) {\r\n                    if (layerGroup.subLayerIds !== null) {\r\n                        layerGroup.Layers = [];\r\n                        _.each(rawlayers, function (rawlayer) {\r\n                            if (layerGroup.id === rawlayer.parentLayerId) {\r\n                                rawlayer.parent = layerGroup;\r\n                                layerGroup.Layers.push(rawlayer);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n                thema.UpdateMap = function () {\r\n                    thema.RecalculateVisibleLayerIds();\r\n                    thema.MapData.setLayers(thema.VisibleLayerIds);\r\n                };\r\n\r\n                thema.RecalculateVisibleLayerIds = function () {\r\n                    thema.VisibleLayerIds.length = 0;\r\n                    _.forEach(thema.VisibleLayers, function (visLayer) {\r\n                        thema.VisibleLayerIds.push(visLayer.id);\r\n                    });\r\n                    if (thema.VisibleLayerIds.length === 0) {\r\n                        thema.VisibleLayerIds.push(-1); //als we niet doen dan zoekt hij op alle lagen!\r\n                    }\r\n                };\r\n                thema.RecalculateVisibleLayerIds();\r\n            }\r\n            catch (ex) {\r\n                console.log('Error when creating theme from url: ' + getData.url + ' Exeption: ' + ex + ' Data: ');\r\n                console.log(rawdata);\r\n            }\r\n            return thema;\r\n        };\r\n        return themeHelper;\r\n    };\r\n    module.$inject = ['map'];\r\n    module.factory('ThemeHelper', service);\r\n})();\r\n"]}