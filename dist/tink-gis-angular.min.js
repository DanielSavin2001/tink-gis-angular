/*! tink-gis-angular v1.0.0 */
"use strict";!function(module){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter"])}module.controller("addLayerController",["$scope","$modalInstance","ThemeHelper","$q","urls","MapService","MapData","GISService","LayerManagementService",function($scope,$modalInstance,ThemeHelper,$q,urls,MapService,MapData,GISService,LayerManagementService){LayerManagementService.EnabledThemes.length=0,LayerManagementService.AvailableThemes.length=0,console.log(MapData.Themes),LayerManagementService.EnabledThemes=angular.copy(MapData.Themes),$scope.availableThemes=LayerManagementService.AvailableThemes;(function(){$scope.searchTerm="Laden...";var qwhenready=LayerManagementService.ProcessUrls(urls);qwhenready.then(function(allelagen){$scope.searchTerm=""})})();$scope.selectedTheme=null,$scope.copySelectedTheme=null,$scope.themeChanged=function(theme){$scope.selectedTheme=theme,$scope.copySelectedTheme=angular.copy(theme)},$scope.AddOrUpdateTheme=function(){for(var allChecked=!0,noneChecked=!0,x=0;x<$scope.copySelectedTheme.AllLayers.length;x++){var copyLayer=$scope.copySelectedTheme.AllLayers[x],realLayer=$scope.selectedTheme.AllLayers[x];realLayer.enabled=copyLayer.enabled,copyLayer.enabled===!1?allChecked=!1:noneChecked=!1}var alreadyAdded=void 0!=LayerManagementService.EnabledThemes.find(function(x){x.Url===$scope.selectedTheme.Url});if(noneChecked){if($scope.selectedTheme.Added=!1,$scope.selectedTheme.status!=ThemeStatus.NEW)$scope.selectedTheme.status=ThemeStatus.DELETED;else if(alreadyAdded){var index=EnabledThemes.indexOf($scope.selectedTheme);index>-1&&LayerManagementService.EnabledThemes.splice(index,1)}}else allChecked?$scope.selectedTheme.Added=!0:$scope.selectedTheme.Added=null,0==alreadyAdded?LayerManagementService.EnabledThemes.push($scope.selectedTheme):$scope.selectedTheme.status!=ThemeStatus.NEW?($scope.selectedTheme.status=ThemeStatus.UPDATED,console.log("changed naar updated")):console.log("Hij is al new, dus moet hij niet naar updated changen.");$scope.selectedTheme=null,$scope.copySelectedTheme=null},$scope.ok=function(){$modalInstance.$close(LayerManagementService.EnabledThemes)},$scope.cancel=function(){$modalInstance.$dismiss("cancel is pressed")}}])}(),function(module){try{var module=angular.module("tink.gis")}catch(e){var module=angular.module("tink.gis",["tink.accordion","tink.tinkApi"])}module=angular.module("tink.gis"),module.controller("groupLayerController",function($scope){var vm=this;vm.grouplayer=$scope.grouplayer,vm.chkChanged=function(){$scope.$emit("groupCheckboxChangedEvent",$scope.grouplayer)}})}(),function(module){try{var module=angular.module("tink.gis")}catch(e){var module=angular.module("tink.gis",["tink.accordion","tink.tinkApi"])}var theController=module.controller("layerController",function($scope){var vm=this;vm.layer=$scope.layer,vm.chkChanged=function(){$scope.$emit("layerCheckboxChangedEvent",$scope.layer)}});theController.$inject=[]}(),function(module){module=angular.module("tink.gis");var theController=module.controller("layersController",function(MapData,map,ThemeService,$modal){var vm=this;vm.themes=MapData.Themes,vm.selectedLayers=[],vm.AddLayers=function(){var addLayerInstance=$modal.open({templateUrl:"templates/modals/addLayerModalTemplate.html",controller:"addLayerController",resolve:{backdrop:!1,keyboard:!0,urls:function(){return MapData.ThemeUrls}}});addLayerInstance.result.then(function(selectedThemes){ThemeService.AddAndUpdateThemes(selectedThemes)},function(obj){console.log("Modal dismissed at: "+new Date)})}});theController.$inject=["MapData","map","ThemeService","$modal"]}(),function(module){module=angular.module("tink.gis");var theController=module.controller("mapController",function($scope,BaseLayersService,MapService,MapData,map,MapEvents){var vm=this;vm.layerId="",vm.activeInteractieKnop=MapData.ActiveInteractieKnop,vm.SelectableLayers=MapData.VisibleLayers,vm.selectedLayer=MapData.SelectedLayer,vm.drawingType=MapData.DrawingType,vm.showMetenControls=!1,vm.interactieButtonChanged=function(ActiveButton){switch(MapData.CleanAll(),MapData.ActiveInteractieKnop=ActiveButton,vm.activeInteractieKnop=ActiveButton,toggleDrawControls(!1),vm.showMetenControls=!1,ActiveButton){case ActiveInteractieButton.SELECT:toggleDrawControls(!0);break;case ActiveInteractieButton.METEN:vm.showMetenControls=!0}};var toggleDrawControls=function(showControls){showControls?$(".leaflet-draw.leaflet-control").show():$(".leaflet-draw.leaflet-control").hide()};vm.drawingButtonChanged=function(drawOption){switch(MapData.CleanAll(),MapData.RemoveDrawings(),MapData.DrawingType=drawOption,vm.drawingType=drawOption,MapData.DrawingType){case DrawingOption.AFSTAND:MapData.DrawingObject=new L.Draw.Polyline(map),MapData.DrawingObject.enable();break;case DrawingOption.OPPERVLAKTE:var polygon_options={showArea:!0,shapeOptions:{stroke:!0,color:"#22528b",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.6,clickable:!0}};MapData.DrawingObject=new L.Draw.Polygon(map,polygon_options),MapData.DrawingObject.enable()}},vm.layerChange=function(){MapData.CleanMap(),MapData.SelectedLayer=vm.selectedLayer},vm.zoomIn=function(){map.zoomIn()},vm.zoomOut=function(){map.zoomOut()},vm.fullExtent=function(){map.setView(new L.LatLng(51.2192159,4.4028818),16)},vm.kaartIsGetoond=!0,vm.toonKaart=function(){vm.kaartIsGetoond=!0,map.removeLayer(BaseLayersService.luchtfoto),map.addLayer(BaseLayersService.kaart)},vm.toonLuchtfoto=function(){vm.kaartIsGetoond=!1,map.removeLayer(BaseLayersService.kaart),map.addLayer(BaseLayersService.luchtfoto)}});theController.$inject=["BaseLayersService","MapService","MapData","map","MapEvents"]}(),function(module){module=angular.module("tink.gis"),module.controller("themeController",["$scope","MapService","ThemeService",function($scope,MapService,ThemeService){var vm=this;console.log("Theme geladen"),vm.theme=$scope.theme,$scope.$on("groupCheckboxChangedEvent",function(event,groupLayer){MapService.UpdateGroupLayerStatus(groupLayer,vm.theme),ThemeService.UpdateThemeVisibleLayers(vm.theme)}),$scope.$on("layerCheckboxChangedEvent",function(event,layer){MapService.UpdateLayerStatus(layer,vm.theme),ThemeService.UpdateThemeVisibleLayers(vm.theme)}),vm.chkChanged=function(){MapService.UpdateThemeStatus(vm.theme),ThemeService.UpdateThemeVisibleLayers(vm.theme)},vm.deleteTheme=function(){ThemeService.DeleteTheme(vm.theme)}}])}(),function(module){module=angular.module("tink.gis"),module.directive("tinkGrouplayer",function(){return{replace:!0,scope:{grouplayer:"="},templateUrl:"templates/groupLayerTemplate.html",controller:"groupLayerController",controllerAs:"grplyrctrl"}})}(),function(module){angular.module("tink.gis").directive("indeterminateCheckbox",[function(){return{scope:!0,require:"?ngModel",link:function(scope,element,attrs,modelCtrl){function watchChildrenListWithProperty(){return scope.$eval(childList).map(function(x){x[property]})}var childList=attrs.childList,property=attrs.property;element.bind("change",function(){scope.$apply(function(){var isChecked=element.prop("checked");angular.forEach(scope.$eval(childList),function(child){child[property]=isChecked})})}),scope.$watch(watchChildrenListWithProperty,function(newValue,oldValue){if(newValue!==oldValue){var hasChecked=!1,hasUnchecked=!1;angular.forEach(newValue,function(child){child?hasChecked=!0:hasUnchecked=!0}),hasChecked&&hasUnchecked?(element.prop("checked",!0),element.prop("indeterminate",!0),modelCtrl&&modelCtrl.$setViewValue(!0)):(element.prop("checked",hasChecked),element.prop("indeterminate",!1),modelCtrl&&modelCtrl.$setViewValue(hasChecked))}},!0)}}}])}(),function(module){module=angular.module("tink.gis"),module.directive("tinkLayer",function(){return{replace:!0,scope:{layer:"="},templateUrl:"templates/layerTemplate.html",controller:"layerController",controllerAs:"lyrctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("tinkLayers",function(){return{replace:!0,templateUrl:"templates/layersTemplate.html",controller:"layersController",controllerAs:"lyrsctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("tinkMap",function(){return{replace:!0,templateUrl:"templates/mapTemplate.html",controller:"mapController",controllerAs:"mapctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("tinkTheme",function(){return{replace:!0,scope:{theme:"="},templateUrl:"templates/themeTemplate.html",controller:"themeController",controllerAs:"thmctrl"}})}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter"])}module.constant("appConfig",{templateUrl:"/digipolis.stadinkaart.webui",apiUrl:"/digipolis.stadinkaart.api/",enableDebug:!0,enableLog:!0}),module.directive("preventDefault",function(){return function(scope,element,attrs){angular.element(element).bind("click",function(event){event.preventDefault(),event.stopPropagation()}),angular.element(element).bind("dblclick",function(event){event.preventDefault(),event.stopPropagation()})}});var mapObject=function(){var map=L.map("map",{center:[51.2192159,4.4028818],zoom:16,layers:L.tileLayer("http://tiles.arcgis.com/tiles/1KSVSmnHT2Lw9ea6/arcgis/rest/services/basemap_stadsplan_v6/MapServer/tile/{z}/{y}/{x}",{id:"kaart"}),zoomControl:!1,drawControl:!0});map.doubleClickZoom.disable(),L.control.scale({imperial:!1}).addTo(map);var drawnItems=L.featureGroup().addTo(map);return map.on("draw:created",function(event){var layer=event.layer;drawnItems.addLayer(layer)}),map.on("draw:drawstart",function(event){console.log(drawnItems),map.clearDrawings()}),map.clearDrawings=function(){drawnItems.clearLayers()},map};module.factory("map",mapObject)}();var ThemeStatus={UNMODIFIED:0,NEW:1,UPDATED:2,DELETED:3},LayerType={LAYER:0,GROUP:1},ActiveInteractieButton={IDENTIFY:"identify",SELECT:"select",METEN:"meten",WATISHIER:"watishier"},DrawingOption={NIETS:"",AFSTAND:"afstand",OPPERVLAKTE:"oppervlakte"};!function(){var module=angular.module("tink.gis"),service=function($http,map,MapData,HelperService,$rootScope){var _service={};return _service.ReverseGeocode=function(event){var lambert72Cords=HelperService.ConvertWSG84ToLambert72(event.latlng),loc=lambert72Cords.x+","+lambert72Cords.y,urlloc=encodeURIComponent(loc);MapData.CleanWatIsHier(),$http.get("http://app10.p.gis.local/arcgissql/rest/services/COMLOC_CRAB_NAVTEQ/GeocodeServer/reverseGeocode?location="+urlloc+"&distance=50&outSR=&f=json").success(function(data,status,headers,config){data.error?MapData.CreateOrigineleMarker(event.latlng,!1):(MapData.CreateWatIsHierMarker(data),console.log(data),MapData.CreateOrigineleMarker(event.latlng,!0))}).error(function(data,status,headers,config){console.log("ERROR!"),console.log(status),console.log(headers),console.log(data)})},_service.GetThemeData=function(url){var prom=$http.get(url);return prom},_service.GetThemeLayerData=function(mapServiceUrl){var prom=$http.get(mapServiceUrl+"layers?f=pjson");return prom},_service};module.$inject=["$http","map","MapData","HelperService","$rootScope"],module.factory("GISService",service)}(),function(){try{var module=angular.module("tink.gis")}catch(e){var module=angular.module("tink.gis",["tink.accordion","tink.tinkApi"])}var baseLayersService=function(){var _baseLayersService={};return _baseLayersService.kaart=L.tileLayer("http://app10.p.gis.local/arcgissql/rest/services/P_Publiek/P_basemap/MapServer",{id:"kaart"}),_baseLayersService.luchtfoto=L.tileLayer("http://tile.informatievlaanderen.be/ws/raadpleegdiensten/tms/1.0.0/omwrgbmrvl@GoogleMapsVL/{z}/{x}/{y}.png",{id:"luchtfoto",tms:"true"}),_baseLayersService};module.factory("BaseLayersService",baseLayersService)}(),function(){var module=angular.module("tink.gis"),service=function(){var _service={};return proj4.defs("LAMBERT72","+proj=lcc +lat_1=51.16666723333334 +lat_2=49.83333389999999 +lat_0=90 +lon_0=4.367486666666666 +x_0=150000.013 +y_0=5400088.438 +ellps=intl +towgs84=-99.1,53.3,-112.5,0.419,-0.83,1.885,-1.0 +units=m +no_defs"),_service.ConvertWSG84ToLambert72=function(coordinates){var result=proj4("LAMBERT72",[coordinates.lng||coordinates.x,coordinates.lat||coordinates.y]);return{x:result[0],y:result[1]}},_service.ConvertLambert72ToWSG84=function(coordinates){var x=coordinates.lng||coordinates.x||coordinates[0],y=coordinates.lat||coordinates.y||coordinates[1],result=proj4("LAMBERT72","WGS84",[x,y]);return console.log(result),{y:result[0],x:result[1]}},_service};module.factory("HelperService",service)}(),function(){var module=angular.module("tink.gis"),service=function(MapData,$http,$q,GISService,ThemeHelper){var _service={};return _service.EnabledThemes=[],_service.AvailableThemes=[],_service.ProcessUrls=function(urls){console.log("ProcesUrls");var promises=[];return console.log(_service.AvailableThemes),_.each(urls,function(url){var AlreadyAddedTheme=null;if(_service.EnabledThemes.forEach(function(theme){theme.Url==url&&(AlreadyAddedTheme=theme)}),null==AlreadyAddedTheme){var prom=GISService.GetThemeData(url+"?f=pjson");prom.success(function(data,statuscode,functie,getdata){var convertedTheme=ThemeHelper.createThemeFromJson(data,getdata);_service.AvailableThemes.push(convertedTheme),convertedTheme.status=ThemeStatus.NEW}),promises.push(prom)}else AlreadyAddedTheme.status=ThemeStatus.UNMODIFIED,_service.AvailableThemes.push(AlreadyAddedTheme)}),$q.all(promises)},_service.SetAditionalLayerInfo=function(theme){console.log(theme.CleanUrl);var prom=GISService.GetThemeLayerData(theme.CleanUrl);prom.success(function(data,statuscode,functie,getdata){theme.AllLayers.forEach(function(layer){var layerid=layer.id,layerInfo=data.layers[layerid];layerInfo.displayField;layer.displayField=layerInfo.displayField})})},_service};module.$inject=["MapData","$http","$q","GISService","ThemeHelper"],module.factory("LayerManagementService",service)}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi",["ui.sortable"]])}var layersService=function($http,map){var _layersService={};return _layersService};module.$inject=["$http","map"],module.factory("LayersService",layersService)}(),function(){var module=angular.module("tink.gis"),mapData=function(map,$rootScope,HelperService,ResultsData){var _data={};_data.VisibleLayers=[],_data.SelectableLayers=[],_data.VisibleFeatures=[],_data.IsDrawing=!1,_data.ThemeUrls=["http://app11.p.gis.local/arcgissql/rest/services/P_Stad/Afval/MapServer/","http://app11.p.gis.local/arcgissql/rest/services/P_Stad/Cultuur/MapServer/","http://app11.p.gis.local/arcgissql/rest/services/P_Stad/Jeugd/MapServer/","http://app11.p.gis.local/arcgissql/rest/services/P_Stad/Onderwijs/MapServer/","http://app11.p.gis.local/arcgissql/rest/services/P_Stad/stad/MapServer/"],_data.Themes=[];var defaultlayer={id:"",name:"Alle Layers"};_data.SelectedLayer=defaultlayer,_data.VisibleLayers.unshift(defaultlayer),_data.ActiveInteractieKnop=ActiveInteractieButton.SELECT,_data.DrawingType=DrawingOption.NIETS,_data.DrawingObject=null,_data.RemoveDrawings=function(){_data.DrawingObject&&(_data.DrawingObject.disable(),_data.DrawingObject=null)};var WatIsHierMarker=null,WatIsHierOriginalMarker=null;_data.CleanAll=function(){_data.RemoveDrawings(),_data.CleanMap(),_data.CleanWatIsHier(),ResultsData.CleanSearch()},_data.CleanWatIsHier=function(){WatIsHierOriginalMarker&&(WatIsHierOriginalMarker.clearAllEventListeners(),WatIsHierOriginalMarker.closePopup(),map.removeLayer(WatIsHierOriginalMarker),WatIsHierOriginalMarker=null),WatIsHierMarker&&(map.removeLayer(WatIsHierMarker),WatIsHierMarker=null),straatNaam=null},_data.CreateOrigineleMarker=function(latlng,addressFound){if(addressFound){var foundMarker=L.AwesomeMarkers.icon({icon:"fa-map-marker",markerColor:"orange"});WatIsHierOriginalMarker=L.marker([latlng.lat,latlng.lng],{icon:foundMarker,opacity:.5}).addTo(map)}else{var notFoundMarker=L.AwesomeMarkers.icon({icon:"fa-question",markerColor:"red",spin:!0});WatIsHierOriginalMarker=L.marker([latlng.lat,latlng.lng],{icon:notFoundMarker}).addTo(map)}var convertedxy=HelperService.ConvertWSG84ToLambert72(latlng);if(straatNaam){var html='<div class="container container-low-padding"><div class="row row-no-padding"><div class="col-sm-4"><img src="https://placehold.it/100x50" /></div><div class="col-sm-8"><div class="col-sm-12"><b>'+straatNaam+'</b></div><div class="col-sm-3">WGS84:</div><div class="col-sm-8" style="text-align: left;">'+latlng.lat.toFixed(6)+", "+latlng.lng.toFixed(6)+'</div><div class="col-sm-1"><i class="fa fa-files-o"></i></div><div class="col-sm-3">Lambert:</div><div class="col-sm-8" style="text-align: left;">'+convertedxy.x.toFixed(1)+", "+convertedxy.y.toFixed(1)+'</div><div class="col-sm-1"><i class="fa fa-files-o"></i></div></div></div></div>';WatIsHierOriginalMarker.bindPopup(html,{minWidth:300}).openPopup()}else WatIsHierOriginalMarker.bindPopup("WGS84 (x,y):"+latlng.lat.toFixed(6)+","+latlng.lng.toFixed(6)+"<br>Lambert (x,y):"+convertedxy.x.toFixed(1)+","+convertedxy.y.toFixed(1)).openPopup();WatIsHierOriginalMarker.on("popupclose",function(event){_data.CleanWatIsHier()})};var straatNaam=null;return _data.CreateWatIsHierMarker=function(data){var convertedBackToWSG84=HelperService.ConvertLambert72ToWSG84(data.location);straatNaam=data.address.Street+" ("+data.address.Postal+")";var greenIcon=L.icon({iconUrl:"styles/fa-dot-circle-o_24_0_000000_none.png",iconSize:[24,24]});WatIsHierMarker=L.marker([convertedBackToWSG84.x,convertedBackToWSG84.y],{icon:greenIcon}).addTo(map)},_data.CleanMap=function(){for(var x=0;x<_data.VisibleFeatures.length;x++)map.removeLayer(_data.VisibleFeatures[x]);_data.VisibleFeatures.length=0,map.clearDrawings()},_data.AddFeatures=function(features,theme){for(var x=0;x<features.features.length;x++){var featureItem=features.features[x],layer=theme.AllLayers[featureItem.layerId];layer.id!=featureItem.layerId&&console.log("ERROR!! moet zelfde layer zijn!!!!!!"),featureItem.layerName=layer.name,featureItem.displayValue=featureItem.properties[layer.displayField];var myStyle={fillOpacity:0},mapItem=L.geoJson(featureItem,{style:myStyle}).addTo(map);_data.VisibleFeatures.push(mapItem),featureItem.mapItem=mapItem,ResultsData.JsonFeatures.push(featureItem),console.log(featureItem.id),console.log(featureItem)}$rootScope.$apply()},_data};module.$inject=["ResultsData"],module.factory("MapData",mapData)}(),function(){var module=angular.module("tink.gis"),mapEvents=function(map,MapService,MapData){var _mapEvents={};map.on("draw:drawstart",function(event){console.log("draw started"),MapData.IsDrawing=!0,MapData.CleanMap()});var berkenOmtrek=function(layer){var tempLatLng=null,totalDistance=0;return _.each(layer._latlngs,function(latlng){return null==tempLatLng?void(tempLatLng=latlng):(console.log(tempLatLng.distanceTo(latlng)+" m"),totalDistance+=tempLatLng.distanceTo(latlng),void(tempLatLng=latlng))}),totalDistance.toFixed(2)};return map.on("click",function(event){if(console.log("click op map! Is drawing: "+MapData.IsDrawing),MapData.IsDrawing)switch(console.log("DrawingObject: "),console.log(MapData.DrawingObject),MapData.DrawingType){case DrawingOption.AFSTAND:break;case DrawingOption.OPPERVLAKTE:break;default:console.log("Aant drawen zonder een gekent type!!!!!!")}else switch(MapData.CleanAll(),MapData.ActiveInteractieKnop){case ActiveInteractieButton.IDENTIFY:MapService.Identify(event,2);break;case ActiveInteractieButton.SELECT:""===MapData.SelectedLayer.id?console.log("Geen layer selected! kan dus niet opvragen"):MapService.Select(event);break;case ActiveInteractieButton.WATISHIER:MapService.WatIsHier(event);break;case ActiveInteractieButton.METEN:break;default:console.log("MAG NIET!!!!!!!!")}}),map.on("draw:created",function(e){switch(console.log("draw created"),console.log(e),MapData.ActiveInteractieKnop){case ActiveInteractieButton.SELECT:""==MapData.SelectedLayer.id?console.log("Geen layer selected! kan dus niet opvragen"):MapService.Query(event);break;case ActiveInteractieButton.METEN:switch(MapData.DrawingType){case DrawingOption.AFSTAND:var omtrek=berkenOmtrek(e.layer);e.layer.bindPopup("Afstand (m): "+omtrek+" "),e.layer.openPopup();break;case DrawingOption.OPPERVLAKTE:var omtrek=berkenOmtrek(e.layer),popuptekst="<p>Opp  (km<sup>2</sup>): "+(LGeo.area(e.layer)/1e6).toFixed(2)+"</p><p>Omtrek (m): "+omtrek+" </p>";e.layer.bindPopup(popuptekst),e.layer.openPopup()}break;default:console.log("MAG NIET!!!!!!!!")}MapData.IsDrawing=!1}),_mapEvents};module.factory("MapEvents",mapEvents)}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","tink.modal"])}var mapService=function($rootScope,MapData,map,ThemeHelper,$q,GISService){var _mapService={};return _mapService.Identify=function(event,tolerance){"undefined"==typeof tolerance&&(tolerance=2),_.each(MapData.Themes,function(theme){theme.RecalculateVisibleLayerIds();var identifOnThisTheme=!0;if(1===theme.VisibleLayerIds.length&&-1===theme.VisibleLayerIds[0])identifOnThisTheme=!1;else var layersVoorIdentify="visible: "+theme.VisibleLayerIds;identifOnThisTheme&&theme.MapData.identify().on(map).at(event.latlng).layers(layersVoorIdentify).tolerance(tolerance).run(function(error,featureCollection){MapData.AddFeatures(featureCollection,theme)})})},_mapService.Select=function(event){console.log(MapData.SelectedLayer),MapData.SelectedLayer.theme.MapData.identify().on(map).at(event.latlng).layers("visible: "+MapData.SelectedLayer.id).run(function(error,featureCollection){MapData.AddFeatures(featureCollection)})},_mapService.WatIsHier=function(event){GISService.ReverseGeocode(event)},_mapService.Query=function(event){MapData.SelectedLayer.theme.MapData.query().layer("visible: "+MapData.SelectedLayer.id).intersects(event.layer).run(function(error,featureCollection,response){MapData.AddFeatures(featureCollection)})},_mapService.UpdateThemeStatus=function(theme){_.each(theme.Groups,function(layerGroup){_mapService.UpdateGroupLayerStatus(layerGroup,theme)}),_.each(theme.Layers,function(layer){_mapService.UpdateLayerStatus(layer,theme)})},_mapService.UpdateGroupLayerStatus=function(groupLayer,theme){_.each(groupLayer.Layers,function(childlayer){_mapService.UpdateLayerStatus(childlayer,theme)})},_mapService.UpdateLayerStatus=function(layer,theme){var visibleOnMap=theme.Visible&&layer.visible&&(layer.parent&&layer.parent.visible||!layer.parent),indexOfLayerInVisibleLayers=theme.VisibleLayers.indexOf(layer);if(visibleOnMap)-1===indexOfLayerInVisibleLayers&&layer.enabled&&(theme.VisibleLayers.push(layer),MapData.VisibleLayers.push(layer));else if(indexOfLayerInVisibleLayers>-1){theme.VisibleLayers.splice(indexOfLayerInVisibleLayers,1);var indexOfLayerInVisibleLayersOfMap=MapData.VisibleLayers.indexOf(layer);MapData.VisibleLayers.splice(indexOfLayerInVisibleLayersOfMap,1)}},_mapService};module.$inject=["$rootScope","MapData","map","ThemeHelper","$q"],module.factory("MapService",mapService)}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi"])}var service=function(map){var themeHelper={};return themeHelper.createThemeFromJson=function(rawdata,getData){var thema={};try{var rawlayers=rawdata.layers,cleanUrl=getData.url.substring(0,getData.url.indexOf("?"));thema.Naam=rawdata.documentInfo.Title,thema.name=rawdata.documentInfo.Title,thema.Description=rawdata.documentInfo.Subject,thema.Layers=[],thema.AllLayers=[],thema.Groups=[],thema.CleanUrl=cleanUrl,thema.Url=getData.url,thema.VisibleLayers=[],thema.VisibleLayerIds=[],thema.Visible=!0,thema.Added=!1,thema.enabled=!0,thema.MapData={},_.each(rawlayers,function(x){x.visible=!0,x.enabled=!0,x.parent=null,x.theme=thema,x.type=LayerType.LAYER,thema.AllLayers.push(x),-1===x.parentLayerId&&(null===x.subLayerIds?thema.Layers.push(x):(thema.Groups.push(x),x.type=LayerType.GROUP))}),_.each(thema.Groups,function(layerGroup){null!==layerGroup.subLayerIds&&(layerGroup.Layers=[],_.each(rawlayers,function(rawlayer){layerGroup.id===rawlayer.parentLayerId&&(rawlayer.parent=layerGroup,layerGroup.Layers.push(rawlayer))}))}),thema.RecalculateVisibleLayerIds=function(){thema.VisibleLayerIds.length=0,_.forEach(thema.VisibleLayers,function(visLayer){thema.VisibleLayerIds.push(visLayer.id)}),0===thema.VisibleLayerIds.length&&thema.VisibleLayerIds.push(-1)},thema.RecalculateVisibleLayerIds()}catch(ex){console.log("Error when creating theme from url: "+getData.url+" Exeption: "+ex+" Data: "),console.log(rawdata)}return thema},themeHelper};module.$inject=["map"],module.factory("ThemeHelper",service)}(),function(){var module=angular.module("tink.gis"),service=function(map,ThemeHelper,MapData,LayerManagementService){var _service={};return _service.AddAndUpdateThemes=function(themesBatch){themesBatch.forEach(function(theme){var existingTheme=MapData.Themes.find(function(x){x.Url==theme.Url});switch(theme.status){case ThemeStatus.NEW:LayerManagementService.SetAditionalLayerInfo(theme),console.log(theme.CleanUrl),_service.AddNewTheme(theme);break;case ThemeStatus.DELETED:_service.DeleteTheme(existingTheme);break;case ThemeStatus.UNMODIFIED:break;case ThemeStatus.UPDATED:_service.UpdateTheme(theme,existingTheme),_service.UpdateThemeVisibleLayers(existingTheme);break;default:console.log("Er is iets fout, status niet bekend"+theme.status)}})},_service.UpdateThemeVisibleLayers=function(theme){theme.RecalculateVisibleLayerIds(),console.log(theme.VisibleLayerIds),theme.MapData.setLayers(theme.VisibleLayerIds)},_service.UpdateTheme=function(updatedTheme,existingTheme){for(var x=0;x<updatedTheme.AllLayers.length;x++){var updatedLayer=updatedTheme.AllLayers[x],existingLayer=existingTheme.AllLayers[x];updatedLayer.enabled&&updatedLayer.visible?(-1==MapData.VisibleLayers.indexOf(existingLayer)&&MapData.VisibleLayers.push(existingLayer),-1==existingTheme.VisibleLayers.indexOf(existingLayer)&&existingTheme.VisibleLayers.push(existingLayer)):(-1!=MapData.VisibleLayers.indexOf(existingLayer)&&MapData.VisibleLayers.splice(MapData.VisibleLayers.indexOf(existingLayer),1),-1!=existingTheme.VisibleLayers.indexOf(existingLayer)&&existingTheme.VisibleLayers.splice(existingTheme.VisibleLayers.indexOf(existingLayer),1)),existingLayer.enabled=updatedLayer.enabled,existingLayer.visible=updatedLayer.visible}existingTheme.RecalculateVisibleLayerIds()},_service.AddNewTheme=function(theme){MapData.Themes.push(theme),_.each(theme.AllLayers,function(layer){layer.enabled&&layer.visible&&layer.type===LayerType.LAYER&&(console.log(layer.id),MapData.VisibleLayers.push(layer),theme.VisibleLayers.push(layer))}),theme.RecalculateVisibleLayerIds(),theme.MapData=L.esri.dynamicMapLayer({url:theme.CleanUrl,opacity:.5,layers:theme.VisibleLayerIds,useCors:!0}).addTo(map),theme.MapData.on("requeststart",function(obj){console.log("requeststart")}),theme.MapData.on("requestsuccess",function(obj){console.log("requestsuccess")})},_service.DeleteTheme=function(theme){theme.MapData.removeFrom(map);var themeIndex=MapData.Themes.indexOf(theme);themeIndex>-1&&MapData.Themes.splice(themeIndex,1),theme.VisibleLayers.forEach(function(visLayer){var visLayerIndex=MapData.VisibleLayers.indexOf(visLayer);visLayerIndex>-1&&MapData.VisibleLayers.splice(visLayerIndex,1)})},_service};module.$inject=["map","ThemeHelper","MapData","LayerManagementService"],module.factory("ThemeService",service)}(),angular.module("tink.gis").run(["$templateCache",function($templateCache){$templateCache.put("templates/groupLayerTemplate.html",'<div class=layercontroller-checkbox> <input class=visible-box type=checkbox id={{grplyrctrl.grouplayer.name}}{{grplyrctrl.grouplayer.id}} ng-model=grplyrctrl.grouplayer.visible ng-change=grplyrctrl.chkChanged()> <label for={{grplyrctrl.grouplayer.name}}{{grplyrctrl.grouplayer.id}}>{{grplyrctrl.grouplayer.name}}</label> <div ng-repeat="layer in grplyrctrl.grouplayer.Layers | filter :  { enabled: true }"> <tink-layer layer=layer> </tink-layer> </div> </div>'),$templateCache.put("templates/layerTemplate.html","<div class=layercontroller-checkbox> <input class=visible-box type=checkbox ng-model=lyrctrl.layer.visible ng-change=lyrctrl.chkChanged() id={{layer.name}}{{layer.id}}> <label for={{layer.name}}{{layer.id}}> {{layer.name | limitTo: 20}}</label> </div>"),$templateCache.put("templates/layerstemplate.html",'<div data-tink-nav-aside="" data-auto-select=true data-toggle-id=asideNavRight class="nav-aside nav-right"> <aside> <div class=nav-aside-section> <ul ui-sortable ng-model=lyrsctrl.themes> <div ng-repeat="theme in lyrsctrl.themes"> <tink-theme theme=theme> </tink-theme> </div> </ul> <button class="btn btn-primary addlayerbtn" ng-click=lyrsctrl.AddLayers()>Voeg laag toe</button> </div> </aside> </div>'),$templateCache.put("templates/maptemplate.html",'<div class=tink-map> <div id=map class=leafletmap> <div class="btn-group ll searchbtns"> <button type=button class=btn prevent-default><i class="fa fa-map-marker"></i></button>\n<button type=button class=btn prevent-default><i class="fa fa-download"></i></button> </div> <div class="btn-group btn-group-vertical ll interactiebtns"> <button type=button class=btn ng-click="mapctrl.interactieButtonChanged(\'identify\')" ng-class="{active: mapctrl.activeInteractieKnop==\'identify\'}" prevent-default><i class="fa fa-info"></i></button>\n<button type=button class=btn ng-click="mapctrl.interactieButtonChanged(\'select\')" ng-class="{active: mapctrl.activeInteractieKnop==\'select\'}" prevent-default><i class="fa fa-mouse-pointer"></i></button>\n<button type=button class=btn ng-click="mapctrl.interactieButtonChanged(\'meten\')" ng-class="{active: mapctrl.activeInteractieKnop==\'meten\'}" prevent-default><i class="fa fa-expand"></i></button>\n<button type=button class=btn ng-click="mapctrl.interactieButtonChanged(\'watishier\')" ng-class="{active: mapctrl.activeInteractieKnop==\'watishier\'}" prevent-default><i class="fa fa-thumb-tack"></i></button>  </div> <div class="btn-group ll metenbtns" ng-show=mapctrl.showMetenControls> <button ng-click="mapctrl.drawingButtonChanged(\'afstand\')" ng-class="{active: mapctrl.drawingType==\'afstand\'}" type=button class=btn prevent-default><i class="fa fa-arrows-h"></i></button>\n<button ng-click="mapctrl.drawingButtonChanged(\'oppervlakte\')" ng-class="{active: mapctrl.drawingType==\'oppervlakte\'}" type=button class=btn prevent-default><i class="fa fa-star-o"></i></button> </div> <div class="ll zoekbalken"> <input class=zoekbalk placeholder="Welke locatie of adres zoek je?" prevent-default> <select ng-options="layer as layer.name for layer in mapctrl.SelectableLayers" ng-model=mapctrl.selectedLayer ng-change=mapctrl.layerChange() ng-class="{invisible: mapctrl.activeInteractieKnop!=\'select\' && mapctrl.SelectableLayers.length<=1}" prevent-default></select> </div> <div class="ll btn-group kaarttypes"> <button class=btn ng-class="{active: mapctrl.kaartIsGetoond==true}" ng-click=mapctrl.toonKaart() prevent-default>Kaart</button>\n<button class=btn ng-class="{active: mapctrl.kaartIsGetoond==false}" ng-click=mapctrl.toonLuchtfoto() prevent-default>Luchtfoto</button> </div> <div class="btn-group btn-group-vertical ll viewbtns"> <button type=button class=btn ng-click=mapctrl.zoomIn() prevent-default><i class="fa fa-plus"></i></button>\n<button type=button class=btn ng-click=mapctrl.zoomOut() prevent-default><i class="fa fa-minus"></i></button>\n<button type=button class=btn ng-click="" prevent-default><i class="fa fa-crosshairs"></i></button>\n<button type=button class=btn ng-click=mapctrl.fullExtent() prevent-default><i class="fa fa-home"></i></button> </div> <div class="btn-group btn-group-vertical ll localiseerbtn"> <button type=button class=btn prevent-default><i class="fa fa-male"></i></button> </div> </div> <tink-search></tink-search> <tink-layers></tink-layers> </div>'),
$templateCache.put("templates/themeTemplate.html",'<div> <input class=visible-box type=checkbox id=chk{{thmctrl.theme.Naam}} ng-model=thmctrl.theme.Visible ng-change=thmctrl.chkChanged()> <label for=chk{{thmctrl.theme.Naam}}> {{thmctrl.theme.Naam}} </label><button ng-click=thmctrl.deleteTheme()><i class="fa fa-trash"></i></button> <div class=layercontroller-checkbox ng-repeat="layer in thmctrl.theme.Layers | filter: { enabled: true }"> <tink-layer layer=layer> </tink-layer> </div> <div class=layercontroller-checkbox ng-repeat="group in thmctrl.theme.Groups | filter: { enabled: true }"> <tink-grouplayer grouplayer=group> </tink-grouplayer> </div> </div>')}]);
//# sourceMappingURL=tink-gis-angular.min.js.map