/*! tink-gis-angular v1.0.0 */
"use strict";!function(module){try{var module=angular.module("tink.gis.angular")}catch(e){var module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi"])}module=angular.module("tink.gis.angular"),module.controller("groupLayerController",function($scope){$scope.visChanged=function(){$scope.$emit("groupCheckboxChangedEvent",$scope.grouplayer)}})}(),function(module){try{var module=angular.module("tink.gis.angular")}catch(e){var module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi"])}var theController=module.controller("layerController",function($scope,$http,GisDataService){$scope.visChanged=function(){$scope.$emit("layerCheckboxChangedEvent",$scope.layer)}});theController.$inject=["GisDataService"]}(),function(module){module=angular.module("tink.gis.angular");var theController=module.controller("layersController",function($scope,GisDataService,$http,map,MapService){$scope.themes=MapService.Themes,$scope.selectedLayers=[]});theController.$inject=["GisDataService","$http","map","MapService"]}(),function(module){module=angular.module("tink.gis.angular");var theController=module.controller("mapController",function($scope,HelperService,GisDataService,BaseLayersService,MapService,$http,map){$scope.layerId="",$scope.activeInteractieKnop="select",$scope.selectedLayer={},$scope.VisibleLayers=MapService.VisibleLayers,map.on("click",function(e){if(!IsDrawing)switch(cleanMapAndSearch(),$scope.activeInteractieKnop){case"identify":_.each(MapService.Themes,function(theme){theme.MapData.identify().on(map).at(e.latlng).layers("visible:"+$scope.selectedLayer.id).run(function(error,featureCollection){for(var x=0;x<featureCollection.features.length;x++){MapService.JsonFeatures.push(featureCollection.features[x]);var item=L.geoJson(featureCollection.features[x]).addTo(map);MapService.VisibleFeatures.push(item)}$scope.$apply()})});break;case"select":_.isEmpty($scope.selectedLayer)?console.log("Geen layer selected! kan dus niet opvragen"):$scope.selectedLayer.theme.MapData.identify().on(map).at(e.latlng).layers("visible:"+$scope.selectedLayer.id).run(function(error,featureCollection){for(var x=0;x<featureCollection.features.length;x++){MapService.JsonFeatures.push(featureCollection.features[x]);var item=L.geoJson(featureCollection.features[x]).addTo(map);MapService.VisibleFeatures.push(item)}$scope.$apply()});break;default:console.log("MAG NOG NIET!!!!!!!!")}});var IsDrawing=!1;map.on("draw:drawstart",function(event){IsDrawing=!0,cleanMapAndSearch()}),map.on("draw:created",function(event){switch(console.log("draw created"),console.log(event),$scope.activeInteractieKnop){case"identify":console.log("MAG NIET!!!!!!!!");break;case"select":_.isEmpty($scope.selectedLayer)?console.log("Geen layer selected! kan dus niet opvragen"):$scope.selectedLayer.theme.MapData.query().layer($scope.selectedLayer.id).intersects(event.layer).run(function(error,featureCollection,response){for(var x=0;x<featureCollection.features.length;x++){MapService.JsonFeatures.push(featureCollection.features[x]);var item=L.geoJson(featureCollection.features[x]).addTo(map);MapService.VisibleFeatures.push(item)}$scope.$apply()});break;default:console.log("MAG NOG NIET!!!!!!!!")}IsDrawing=!1});var cleanMapAndSearch=function(){for(var x=0;x<MapService.VisibleFeatures.length;x++)map.removeLayer(MapService.VisibleFeatures[x]);MapService.VisibleFeatures.length=0,MapService.JsonFeatures.length=0};$scope.identify=function(){cleanMapAndSearch(),$scope.activeInteractieKnop="identify",$(".leaflet-draw.leaflet-control").hide()},$scope.select=function(){cleanMapAndSearch(),$scope.activeInteractieKnop="select",$(".leaflet-draw.leaflet-control").show()},$scope.layerChange=function(){cleanMapAndSearch(),console.log($scope.selectedLayer)},$scope.zoomIn=function(){map.zoomIn()},$scope.zoomOut=function(){map.zoomOut()},$scope.fullExtent=function(){map.setView(new L.LatLng(51.2192159,4.4028818),16)},$scope.kaartIsGetoond=!0,$scope.toonKaart=function(){$scope.kaartIsGetoond=!0,map.removeLayer(BaseLayersService.luchtfoto),map.addLayer(BaseLayersService.kaart)},$scope.toonLuchtfoto=function(){$scope.kaartIsGetoond=!1,map.removeLayer(BaseLayersService.kaart),map.addLayer(BaseLayersService.luchtfoto)}});theController.$inject=["HelperService","GisDataService","BaseLayersService","MapService","$http","map"]}(),function(module){module=angular.module("tink.gis.angular");var theController=module.controller("searchController",function($scope,MapService,map){$scope.features=MapService.JsonFeatures,$scope.Locate=function(){console.log("klik")}});theController.$inject=["MapService","map"]}(),function(module){module=angular.module("tink.gis.angular"),module.controller("themeController",["$scope","MapService",function($scope,MapService){$scope.$on("groupCheckboxChangedEvent",function(event,groupLayer){MapService.UpdateGroupLayerStatus(groupLayer,$scope.theme)}),$scope.$on("layerCheckboxChangedEvent",function(event,layer){MapService.UpdateLayerStatus(layer,$scope.theme)}),$scope.visChanged=function(){MapService.UpdateThemeStatus($scope.theme)}}])}(),function(module){module=angular.module("tink.gis.angular"),module.directive("tinkGrouplayer",function(){return{replace:!0,scope:{grouplayer:"="},templateUrl:"templates/groupLayerTemplate.html",controller:"groupLayerController"}})}(),function(module){module=angular.module("tink.gis.angular"),module.directive("tinkLayer",function(){return{replace:!0,scope:{layer:"="},templateUrl:"templates/layerTemplate.html",controller:"layerController"}})}(),function(module){module=angular.module("tink.gis.angular"),module.directive("tinkLayers",function(){return{replace:!0,templateUrl:"templates/layersTemplate.html",controller:"layersController"}})}(),function(module){module=angular.module("tink.gis.angular"),module.directive("tinkMap",function(){return{replace:!0,templateUrl:"templates/mapTemplate.html",scope:{parlayers:"=",parcenter:"="},controller:"mapController"}})}(),function(module){module=angular.module("tink.gis.angular"),module.directive("tinkSearch",function(){return{replace:!0,templateUrl:"templates/searchTemplate.html",controller:"searchController"}})}(),function(module){module=angular.module("tink.gis.angular"),module.directive("tinkTheme",function(){return{replace:!0,scope:{theme:"="},templateUrl:"templates/themeTemplate.html",controller:"themeController"}})}(),function(){var module;try{module=angular.module("tink.gis.angular")}catch(e){module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi","ui.sortable"])}module.constant("appConfig",{templateUrl:"/digipolis.stadinkaart.webui",apiUrl:"/digipolis.stadinkaart.api/",enableDebug:!0,enableLog:!0}),module.directive("preventDefault",function(){return function(scope,element,attrs){angular.element(element).bind("click",function(event){event.preventDefault(),event.stopPropagation()}),angular.element(element).bind("dblclick",function(event){event.preventDefault(),event.stopPropagation()})}});var mapObject=function(){var map=L.map("map",{center:[51.2192159,4.4028818],zoom:16,layers:L.tileLayer("http://tiles.arcgis.com/tiles/1KSVSmnHT2Lw9ea6/arcgis/rest/services/basemap_stadsplan_v6/MapServer/tile/{z}/{y}/{x}",{id:"kaart"}),zoomControl:!1,drawControl:!0});console.log(map),map.doubleClickZoom.disable(),L.control.scale({imperial:!1}).addTo(map);var drawnItems=L.featureGroup().addTo(map);return map.on("draw:created",function(event){var layer=event.layer;drawnItems.addLayer(layer)}),map.on("draw:drawstart",function(event){console.log(drawnItems),drawnItems.clearLayers()}),map};module.factory("map",mapObject)}(),function(){try{var module=angular.module("tink.gis.angular")}catch(e){var module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi"])}var gisDataService=function(HelperService,$http){var _layerData={};return $http.get("http://app10.a.gis.local/arcgissql/rest/services/A_GeoService/operationallayers/MapServer/?f=pjson").success(function(data){console.log("GOT THE DATA!"),_layerData=data}),{layerData:_layerData,layers:_layerData.layers}};gisDataService.$inject=["HelperService","$http"],module.factory("GisDataService",gisDataService)}(),function(){try{var module=angular.module("tink.gis.angular")}catch(e){var module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi"])}var baseLayersService=function(){var _baseLayersService={};return _baseLayersService.kaart=L.tileLayer("http://tiles.arcgis.com/tiles/1KSVSmnHT2Lw9ea6/arcgis/rest/services/basemap_stadsplan_v6/MapServer/tile/{z}/{y}/{x}",{id:"kaart"}),_baseLayersService.luchtfoto=L.tileLayer("http://tile.informatievlaanderen.be/ws/raadpleegdiensten/tms/1.0.0/omwrgbmrvl@GoogleMapsVL/{z}/{x}/{y}.png",{id:"luchtfoto",tms:"true"}),_baseLayersService};module.factory("BaseLayersService",baseLayersService)}(),function(){try{var module=angular.module("tink.gis.angular")}catch(e){var module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi"])}var helperService=function(){console.log("Helperservice CTOR");var _helperService={};return _helperService.clone=function(obj){var copy;if(null===obj||"object"!=typeof obj)return obj;if(obj instanceof Date)return copy=new Date,copy.setTime(obj.getTime()),copy;if(obj instanceof Array){copy=[];for(var i=0,len=obj.length;len>i;i++)copy[i]=_helperService.clone(obj[i]);return copy}if(obj instanceof Object){copy={};for(var attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=_helperService.clone(obj[attr]));return copy}throw new Error("Unable to copy obj! Its type isn't supported.")},_helperService.findNested=function(obj,key){return _.has(obj,key)?[obj]:_.flatten(_.map(obj,function(v){return"object"==typeof v?_helperService.findNested(v,key):[]}),!0)},_helperService};module.factory("HelperService",helperService)}(),function(){var module;try{module=angular.module("tink.gis.angular")}catch(e){module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi",["ui.sortable"]])}var layersService=function($http,map){var _layersService={};return _layersService};module.$inject=["$http","map"],module.factory("LayersService",layersService)}(),function(){var module;try{module=angular.module("tink.gis.angular")}catch(e){module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi"])}var mapService=function($http,map,ThemeHelper){var _mapService={};return _mapService.VisibleLayers=[],_mapService.jsonFeatures=[],_mapService.VisibleFeatures=[],_mapService.JsonFeatures=[],_mapService.getLayers=["http://geodata.antwerpen.be/ArcGISSql/rest/services/P_Stad/Mobiliteit/MapServer?f=pjson","http://app10.a.gis.local/arcgissql/rest/services/A_Stedenbouw/stad/MapServer?f=pjson","http://app10.a.gis.local/arcgissql/rest/services/A_GeoService/operationallayers/MapServer/?f=pjson"],_mapService.Themes=[],_.each(_mapService.getLayers,function(layerurl){$http.get(layerurl).success(function(data,statuscode,functie,getdata){_mapService.Themes.push(ThemeHelper.createThemeFromJson(data,getdata))})}),_mapService.UpdateLayerStatus=function(layer,theme){var visibleOnMap=theme.Visible&&layer.visible&&(layer.parent&&layer.parent.visible||!layer.parent),indexOfLayerInVisibleLayers=theme.VisibleLayersIds.indexOf(layer.id);if(visibleOnMap)-1===indexOfLayerInVisibleLayers&&(theme.VisibleLayersIds.push(layer.id),_mapService.VisibleLayers.push(layer));else if(indexOfLayerInVisibleLayers>-1){theme.VisibleLayersIds.splice(indexOfLayerInVisibleLayers,1);var indexOfLayerInVisibleLayersOfMap=_mapService.VisibleLayers.indexOf(layer.id);_mapService.VisibleLayers.splice(indexOfLayerInVisibleLayersOfMap,1)}},_mapService.UpdateGroupLayerStatus=function(groupLayer,theme){_.each(groupLayer.Layers,function(childlayer){_mapService.UpdateLayerStatus(childlayer,theme)})},_mapService.UpdateThemeStatus=function(theme){_.each(theme.Groups,function(layerGroup){_mapService.UpdateGroupLayerStatus(layerGroup,theme)}),_.each(theme.Layers,function(layer){_mapService.UpdateLayerStatus(layer,theme)})},_mapService};module.$inject=["$http","map","ThemeHelper"],module.factory("MapService",mapService)}(),function(){var module;try{module=angular.module("tink.gis.angular")}catch(e){module=angular.module("tink.gis.angular",["tink.accordion","tink.tinkApi"])}var service=function(map){var themeHelper={};return themeHelper.createThemeFromJson=function(rawdata,getdata){var thema={},rawlayers=rawdata.layers,cleanUrl=getdata.url.substring(0,getdata.url.indexOf("?"));return thema.Naam=rawdata.documentInfo.Title,thema.Layers=[],thema.VisibleLayersIds=[-1],thema.Groups=[],thema.Visible=!0,thema.MapData=L.esri.dynamicMapLayer({url:cleanUrl,opacity:.5,layers:thema.VisibleLayersIds,useCors:!1}).addTo(map),_.each(rawlayers,function(x){x.visible=!1,x.parent=null,x.theme=thema,-1===x.parentLayerId&&(null===x.subLayerIds?thema.Layers.push(x):thema.Groups.push(x))}),_.each(thema.Groups,function(layerGroup){null!==layerGroup.subLayerIds&&(layerGroup.Layers=[],_.each(rawlayers,function(rawlayer){layerGroup.id===rawlayer.parentLayerId&&(rawlayer.parent=layerGroup,layerGroup.Layers.push(rawlayer))}))}),thema},themeHelper};module.$inject=["$http","map"],module.factory("ThemeHelper",service)}(),angular.module("tink.gis.angular").run(["$templateCache",function($templateCache){$templateCache.put("templates/groupLayerTemplate.html",'<div class=layercontroller-checkbox> <input class=visible-box type=checkbox ng-model=grouplayer.visible ng-change=visChanged()>{{grouplayer.name}} <div ng-repeat="layer in grouplayer.Layers"> <tink-layer layer=layer> </tink-layer> </div> </div>'),$templateCache.put("templates/layerTemplate.html","<div class=layercontroller-checkbox> <input class=visible-box type=checkbox ng-model=layer.visible ng-change=visChanged()>{{layer.name | limitTo: 20}} </div>"),$templateCache.put("templates/layerstemplate.html",'<div data-tink-nav-aside="" data-auto-select=true data-toggle-id=asideNavRight class="nav-aside nav-right"> <aside> <div class=nav-aside-section> <ul ui-sortable ng-model=themes> <div ng-repeat="theme in themes"> <tink-theme theme=theme> </tink-theme> </div> </ul> </div> </aside> </div>'),$templateCache.put("templates/maptemplate.html",'<div class=tink-map> <div id=map class=leafletmap> <div class="btn-group ll searchbtns"> <button type=button class=btn prevent-default><i class="fa fa-map-marker"></i></button>\n<button type=button class=btn prevent-default><i class="fa fa-download"></i></button> </div> <div class="btn-group btn-group-vertical ll interactiebtns"> <button type=button class=btn ng-click=identify() ng-class="{active: activeInteractieKnop==\'identify\'}" prevent-default><i class="fa fa-info"></i></button>\n<button type=button class=btn ng-click=select() ng-class="{active: activeInteractieKnop==\'select\'}" prevent-default><i class="fa fa-mouse-pointer"></i></button>\n<button type=button class=btn ng-class="{active: activeInteractieKnop==\'dunno\'}" prevent-default><i class="fa fa-download"></i></button> </div> <div class="ll zoekbalken"> <input class=zoekbalk placeholder="Welke locatie of adres zoek je?" prevent-default> <select ng-options="layer as layer.name for layer in VisibleLayers track by layer.id" ng-model=selectedLayer ng-change=layerChange() ng-class="{invisible: activeInteractieKnop!=\'select\'}" prevent-default></select> </div> <div class="ll btn-group kaarttypes"> <button class=btn ng-class="{active: kaartIsGetoond==true}" ng-click=toonKaart() prevent-default>Kaart</button>\n<button class=btn ng-class="{active: kaartIsGetoond==false}" ng-click=toonLuchtfoto() prevent-default>Luchtfoto</button> </div> <div class="btn-group btn-group-vertical ll viewbtns"> <button type=button class=btn ng-click=zoomIn() prevent-default><i class="fa fa-plus"></i></button>\n<button type=button class=btn ng-click=zoomOut() prevent-default><i class="fa fa-minus"></i></button>\n<button type=button class=btn ng-click="" prevent-default><i class="fa fa-crosshairs"></i></button>\n<button type=button class=btn ng-click=fullExtent() prevent-default><i class="fa fa-home"></i></button> </div> <div class="btn-group btn-group-vertical ll localiseerbtn"> <button type=button class=btn prevent-default><i class="fa fa-male"></i></button> </div> </div> <tink-layers></tink-layers> <tink-search></tink-search> </div>'),$templateCache.put("templates/searchTemplate.html",'<div data-tink-nav-aside="" data-auto-select=true data-toggle-id=asideNavLeft class="nav-aside nav-left"> <aside> <div class=nav-aside-section> Zoek <div ng-repeat="feature in features "> layerid: {{feature.layerId}} <pre>{{feature.properties | json }}</pre> </div> </div> </aside> </div>'),$templateCache.put("templates/themeTemplate.html",'<div><input class=visible-box type=checkbox ng-model=theme.Visible ng-change=visChanged()>{{theme.Naam}} <div class=layercontroller-checkbox ng-repeat="layer in theme.Layers"> <tink-layer layer=layer> </tink-layer> </div> <div class=layercontroller-checkbox ng-repeat="group in theme.Groups"> <tink-grouplayer grouplayer=group> </tink-grouplayer> </div> </div>')}]);
//# sourceMappingURL=tink-gis-angular.min.map